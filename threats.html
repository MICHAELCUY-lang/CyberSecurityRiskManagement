<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Threats &amp; Vulnerabilities — CyberRisk Pro</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="app">
        <div class="main">
            <header class="topbar">
                <button class="hamburger" onclick="toggleSidebar()"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.75">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg></button>
                <div class="page-header">
                    <div class="page-title">Threats &amp; Vulnerabilities</div>
                    <div class="breadcrumb"><span>Assessment</span><span class="bc-sep">/</span><span
                            class="bc-cur">Threats &amp; Vulnerabilities</span></div>
                </div>
            </header>
            <main class="page">
                <div class="g2">
                    <!-- Left -->
                    <div>
                        <div class="card mb-4">
                            <div class="card-label">Step 1 — Select Asset</div>
                            <select class="form-control" id="assetSel" onchange="loadAsset()">
                                <option value="">Select an information asset to assess</option>
                            </select>
                            <div id="assetInfo" class="hidden mt-4"
                                style="background:var(--input);border:1px solid var(--border);border-radius:var(--r-sm);padding:13px">
                                <div class="flex justify-between mb-2"><span
                                        class="text-xs text-t3 uppercase">Type</span><span class="fw-500 text-sm"
                                        id="aiType"></span></div>
                                <div class="flex justify-between mb-2"><span
                                        class="text-xs text-t3 uppercase">Owner</span><span class="text-sm"
                                        id="aiOwner"></span></div>
                                <div class="flex justify-between"><span
                                        class="text-xs text-t3 uppercase">Criticality</span><span id="aiCrit"></span>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-label">Step 2 — Select Vulnerabilities</div>
                            <div class="vuln-grid" id="vulnGrid">
                                <div class="text-t3 text-sm" style="grid-column:1/-1;padding:16px 0">Select an asset to
                                    view applicable vulnerabilities.</div>
                            </div>
                        </div>
                    </div>
                    <!-- Right -->
                    <div class="card">
                        <div class="card-label">Step 3 — Risk Analysis Results</div>
                        <div id="results">
                            <div class="text-center" style="padding:60px 20px">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"
                                    style="width:48px;height:48px;stroke:var(--border-2);margin:0 auto 12px;display:block">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                                </svg>
                                <p class="text-t3 text-sm">Select an asset and vulnerabilities<br>to view risk analysis
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
        <div class="modal" id="modal-body"></div>
    </div>
    <script src="sidebar.js"></script>
    <script src="app.js"></script>
    <script>
        const VULNS = [
            { id: 'sqli', label: 'SQL Injection', desc: 'Unsanitised database queries', L: 5, I: 5 },
            { id: 'xss', label: 'Cross-Site Scripting', desc: 'Unescaped user output', L: 4, I: 3 },
            { id: 'csrf', label: 'CSRF', desc: 'Missing anti-CSRF tokens', L: 3, I: 3 },
            { id: 'weakpw', label: 'Weak Password Policy', desc: 'No complexity requirements', L: 4, I: 3 },
            { id: 'http', label: 'No HTTPS', desc: 'Unencrypted HTTP traffic', L: 2, I: 4 },
            { id: 'eol', label: 'Outdated OS / Software', desc: 'End-of-life, unpatched systems', L: 3, I: 5 },
            { id: 'ports', label: 'Exposed Admin Ports', desc: 'Administrative ports on public IP', L: 4, I: 5 },
            { id: 'defcred', label: 'Default Credentials', desc: 'Factory passwords unchanged', L: 3, I: 5 },
            { id: 'nologs', label: 'No Audit Logging', desc: 'No centralised logging enabled', L: 4, I: 4 },
        ];
        let selected = [];
        const sel = document.getElementById('assetSel');
        S.assets.forEach(a => { const o = document.createElement('option'); o.value = a.id; o.textContent = a.name; sel.appendChild(o); });

        function loadAsset() {
            const id = +sel.value, a = S.assets.find(x => x.id === id);
            const info = document.getElementById('assetInfo');
            if (!a) { info.classList.add('hidden'); document.getElementById('vulnGrid').innerHTML = '<div class="text-t3 text-sm" style="grid-column:1/-1;padding:16px 0">Select an asset to view applicable vulnerabilities.</div>'; selected = []; updateResults(); return; }
            document.getElementById('aiType').textContent = a.type;
            document.getElementById('aiOwner').textContent = a.owner;
            document.getElementById('aiCrit').innerHTML = `<span class="badge ${critClass(a.criticality)}">${a.criticality}</span>`;
            info.classList.remove('hidden'); selected = [];
            document.getElementById('vulnGrid').innerHTML = VULNS.map(v => `
    <div class="vuln-item" id="vi_${v.id}" onclick="toggle('${v.id}')">
      <input type="checkbox" class="vuln-cb" id="vc_${v.id}"/>
      <div><div class="vuln-label">${v.label}</div><div class="vuln-desc">${v.desc}</div></div>
    </div>`).join('');
            updateResults();
        }

        function toggle(id) {
            const cb = document.getElementById(`vc_${id}`), item = document.getElementById(`vi_${id}`);
            cb.checked = !cb.checked; item.classList.toggle('sel', cb.checked);
            selected = cb.checked ? [...new Set([...selected, id])] : selected.filter(x => x !== id);
            updateResults();
        }

        function colOf(s) { return s >= 15 ? 'var(--red)' : s >= 10 ? 'var(--orange)' : s >= 5 ? 'var(--amber)' : 'var(--green)'; }

        function updateResults() {
            const el = document.getElementById('results');
            const sel2 = VULNS.filter(v => selected.includes(v.id));
            if (!sel2.length) { el.innerHTML = '<div class="text-center" style="padding:40px 20px"><p class="text-t3 text-sm">Select at least one vulnerability to analyse.</p></div>'; return; }
            const maxL = Math.max(...sel2.map(v => v.L)), maxI = Math.max(...sel2.map(v => v.I)), score = maxL * maxI;
            const lvl = score >= 15 ? 'Critical' : score >= 10 ? 'High' : score >= 5 ? 'Medium' : 'Low';
            const bc = critClass(lvl), col = colOf(score);
            el.innerHTML = `
    <div style="text-align:center;padding:18px;background:var(--input);border:1px solid var(--border);border-radius:var(--r-sm);margin-bottom:14px">
      <div class="text-xs text-t3 uppercase mb-2">Composite Risk Score</div>
      <div class="mono fw-700" style="font-size:54px;color:${col};line-height:1">${score}</div>
      <div class="text-xs text-t3 mt-1">out of 25</div>
      <span class="badge ${bc} mt-3" style="font-size:12px;padding:4px 14px">${lvl} Risk</span>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px">
      <div style="background:var(--input);border:1px solid var(--border);border-radius:var(--r-sm);padding:10px;text-align:center">
        <div class="text-xs text-t3 uppercase mb-1">Likelihood</div>
        <div class="mono fw-700 text-blue" style="font-size:26px">${maxL}/5</div>
      </div>
      <div style="background:var(--input);border:1px solid var(--border);border-radius:var(--r-sm);padding:10px;text-align:center">
        <div class="text-xs text-t3 uppercase mb-1">Impact</div>
        <div class="mono fw-700 text-red" style="font-size:26px">${maxI}/5</div>
      </div>
    </div>
    <div class="text-xs text-t3 uppercase mb-2">Selected Vulnerabilities (${sel2.length})</div>
    ${sel2.map(v => {
                const s = v.L * v.I; return `
      <div class="flex justify-between items-center" style="padding:9px 11px;background:var(--input);border:1px solid var(--border);border-radius:var(--r-sm);margin-bottom:6px">
        <div><div class="fw-500 text-sm">${v.label}</div><div class="text-xs text-t3">${v.desc}</div></div>
        <div class="mono text-xs" style="color:${colOf(s)}">L${v.L} &times; I${v.I} = ${s}</div>
      </div>`;
            }).join('')}
    <button class="btn btn-primary w-full mt-4" onclick="showToast('success','Logged','Risk finding added to Findings report.')">Add to Findings</button>`;
        }
    </script>
</body>

</html>