<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Findings — CyberRisk Pro</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="app">
        <div class="main">
            <header class="topbar">
                <button class="hamburger" onclick="toggleSidebar()"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.75">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg></button>
                <div class="page-header">
                    <div class="page-title">Findings</div>
                    <div class="breadcrumb"><span>Compliance</span><span class="bc-sep">/</span><span
                            class="bc-cur">Findings</span></div>
                </div>
                <div class="topbar-actions">
                    <button class="btn btn-ghost btn-sm"
                        onclick="showToast('info','Export','Generating findings export…')">Export</button>
                </div>
            </header>
            <main class="page">

                <!-- Summary bar -->
                <div class="card mb-4">
                    <div class="g4" style="margin-bottom:0">
                        <div
                            style="text-align:center;padding:10px;background:var(--red-10);border:1px solid rgba(201,71,71,.2);border-radius:6px">
                            <div class="mono fw-700 text-red" style="font-size:20px" id="sCrit">4</div>
                            <div class="text-xs text-t3 mt-1">Critical</div>
                        </div>
                        <div
                            style="text-align:center;padding:10px;background:var(--orange-10);border:1px solid rgba(196,99,48,.2);border-radius:6px">
                            <div class="mono fw-700" style="font-size:20px;color:var(--orange)" id="sHigh">2</div>
                            <div class="text-xs text-t3 mt-1">High</div>
                        </div>
                        <div
                            style="text-align:center;padding:10px;background:var(--amber-10);border:1px solid rgba(196,127,40,.2);border-radius:6px">
                            <div class="mono fw-700 text-amber" style="font-size:20px" id="sMed">2</div>
                            <div class="text-xs text-t3 mt-1">Medium</div>
                        </div>
                        <div
                            style="text-align:center;padding:10px;background:var(--green-10);border:1px solid rgba(58,158,110,.2);border-radius:6px">
                            <div class="mono fw-700 text-green" style="font-size:20px" id="sLow">0</div>
                            <div class="text-xs text-t3 mt-1">Low</div>
                        </div>
                    </div>
                </div>

                <div class="toolbar">
                    <div class="search-wrap flex-1">
                        <span class="search-ico"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.75">
                                <circle cx="11" cy="11" r="8" />
                                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                            </svg></span>
                        <input class="form-control" id="q" placeholder="Search findings, assets…" oninput="render()"
                            style="padding-left:34px" />
                    </div>
                    <select class="form-control" id="sf" style="width:140px" onchange="render()">
                        <option value="">All Severity</option>
                        <option>Critical</option>
                        <option>High</option>
                        <option>Medium</option>
                        <option>Low</option>
                    </select>
                </div>

                <div class="ga" id="fGrid"></div>
            </main>
        </div>
    </div>

    <div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
        <div class="modal" id="modal-body"></div>
    </div>
    <script src="sidebar.js"></script>
    <script src="app.js"></script>
    <script>
        function render() {
            const q = (document.getElementById('q').value || '').toLowerCase();
            const sev = document.getElementById('sf').value;
            const list = S.findings.filter(f =>
                (!q || f.title.toLowerCase().includes(q) || f.asset.toLowerCase().includes(q) || f.issue.toLowerCase().includes(q)) &&
                (!sev || f.severity === sev)
            );
            // Update summary counts (use full list, not filtered)
            const all = S.findings;
            document.getElementById('sCrit').textContent = all.filter(x => x.severity === 'Critical').length;
            document.getElementById('sHigh').textContent = all.filter(x => x.severity === 'High').length;
            document.getElementById('sMed').textContent = all.filter(x => x.severity === 'Medium').length;
            document.getElementById('sLow').textContent = all.filter(x => x.severity === 'Low').length;

            // Update sidebar badge
            const nb = document.getElementById('nb-findings');
            if (nb) nb.textContent = all.filter(x => x.severity === 'Critical').length;

            const grid = document.getElementById('fGrid');
            if (!list.length) {
                grid.innerHTML = '<p class="text-t3 text-sm">No findings match your search criteria.</p>';
                return;
            }
            grid.innerHTML = list.map(f => `
    <div class="finding-card ${f.severity.toLowerCase()}">
      <div class="finding-hd">
        <div class="finding-title">${f.title}</div>
        <span class="badge ${critClass(f.severity)}">${f.severity}</span>
      </div>
      <div>
        <div class="finding-lbl">Issue</div>
        <div class="finding-text">${f.issue}</div>
        <div class="finding-lbl">Risk</div>
        <div class="finding-text">${f.risk}</div>
        <div class="finding-lbl" style="color:var(--green)">Recommendation</div>
        <div class="finding-text mb-0">${f.recommendation}</div>
      </div>
      <div class="finding-footer">
        <span class="finding-asset">${f.asset}</span>
        <button class="btn btn-ghost btn-sm" style="margin-left:auto" onclick="resolve(${f.id})">Mark Resolved</button>
      </div>
    </div>`).join('');
        }

        function resolve(id) {
            const f = S.findings.find(x => x.id === id);
            confirmAction(`Mark <strong>"${f?.title}"</strong> as resolved and remove from findings?`, () => {
                S.setFindings(S.findings.filter(x => x.id !== id)); render();
                showToast('success', 'Resolved', 'Finding marked as resolved.');
            });
        }
        render();
    </script>
</body>

</html>