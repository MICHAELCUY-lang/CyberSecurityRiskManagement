<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Asset Inventory — CyberRisk Pro</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="app">
        <div class="main">
            <header class="topbar">
                <button class="hamburger" onclick="toggleSidebar()"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.75">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg></button>
                <div class="page-header">
                    <div class="page-title">Asset Inventory</div>
                    <div class="breadcrumb"><span>Assessment</span><span class="bc-sep">/</span><span
                            class="bc-cur">Asset Inventory</span></div>
                </div>
                <div class="topbar-actions">
                    <button class="btn btn-primary btn-sm" onclick="openAdd()">+ Add Asset</button>
                </div>
            </header>
            <main class="page">
                <div class="toolbar">
                    <div class="search-wrap flex-1">
                        <span class="search-ico"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.75">
                                <circle cx="11" cy="11" r="8" />
                                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                            </svg></span>
                        <input class="form-control" id="q" placeholder="Search by name, owner…" oninput="render()"
                            style="padding-left:34px" />
                    </div>
                    <select class="form-control" id="tf" style="width:160px" onchange="render()">
                        <option value="">All Types</option>
                        <option>Web Application</option>
                        <option>Database</option>
                        <option>Server</option>
                        <option>Cloud Service</option>
                        <option>Network Device</option>
                        <option>Mobile App</option>
                        <option>API Service</option>
                    </select>
                    <div class="view-toggle">
                        <button id="btnT" class="active" title="Table" onclick="setView('table')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75">
                                <line x1="3" y1="12" x2="21" y2="12" />
                                <line x1="3" y1="6" x2="21" y2="6" />
                                <line x1="3" y1="18" x2="21" y2="18" />
                            </svg>
                        </button>
                        <button id="btnC" title="Cards" onclick="setView('card')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75">
                                <rect x="3" y="3" width="7" height="7" />
                                <rect x="14" y="3" width="7" height="7" />
                                <rect x="14" y="14" width="7" height="7" />
                                <rect x="3" y="14" width="7" height="7" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="tableV">
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Asset Name</th>
                                    <th>Type</th>
                                    <th>Owner</th>
                                    <th>Location</th>
                                    <th title="Confidentiality">C</th>
                                    <th title="Integrity">I</th>
                                    <th title="Availability">A</th>
                                    <th>Criticality</th>
                                    <th style="text-align:right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tbody"></tbody>
                        </table>
                    </div>
                </div>
                <div id="cardV" class="hidden ga"></div>
            </main>
        </div>
    </div>

    <div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
        <div class="modal" id="modal-body"></div>
    </div>
    <script src="sidebar.js"></script>
    <script src="app.js"></script>
    <script>
        let view = 'table';
        function setView(v) {
            view = v;
            document.getElementById('btnT').classList.toggle('active', v === 'table');
            document.getElementById('btnC').classList.toggle('active', v === 'card');
            document.getElementById('tableV').classList.toggle('hidden', v !== 'table');
            document.getElementById('cardV').classList.toggle('hidden', v !== 'card');
            render();
        }
        function filtered() {
            const q = (document.getElementById('q').value || '').toLowerCase();
            const t = document.getElementById('tf').value;
            return S.assets.filter(a => (!q || a.name.toLowerCase().includes(q) || a.owner.toLowerCase().includes(q)) && (!t || a.type === t));
        }
        function cia(v) { return `<span class="mono fw-500" style="color:${ciaColor(v)}">${v}</span>`; }

        function render() {
            const list = filtered();
            // Table
            const tb = document.getElementById('tbody');
            if (!list.length) { tb.innerHTML = `<tr><td colspan="9" class="text-center text-t3" style="padding:28px">No assets match your filters</td></tr>`; }
            else tb.innerHTML = list.map(a => `<tr>
    <td class="fw-600">${a.name}</td>
    <td><span class="badge badge-info">${a.type}</span></td>
    <td class="text-t2">${a.owner}</td>
    <td class="text-t3 text-sm">${a.location}</td>
    <td>${cia(a.c)}</td><td>${cia(a.i)}</td><td>${cia(a.a)}</td>
    <td><span class="badge ${critClass(a.criticality)}">${a.criticality}</span></td>
    <td style="text-align:right">
      <button class="btn btn-ghost btn-sm" style="padding:4px 10px;margin-right:4px" onclick="openEdit(${a.id})">Edit</button>
      <button class="btn btn-ghost btn-sm" style="padding:4px 10px;color:var(--red)" onclick="del(${a.id})">Remove</button>
    </td></tr>`).join('');

            // Cards
            const grid = document.getElementById('cardV');
            grid.innerHTML = list.map(a => `<div class="card">
    <div class="flex justify-between items-center mb-3">
      <div class="fw-700" style="font-size:14px;line-height:1.3">${a.name}</div>
      <span class="badge ${critClass(a.criticality)}">${a.criticality}</span>
    </div>
    <div class="text-xs text-t3 mb-3">${a.type} &middot; ${a.location}</div>
    <div class="text-sm mb-3">Owner: <span class="fw-500">${a.owner}</span></div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:14px">
      ${['c', 'i', 'a'].map(k => `<div style="background:var(--input);border:1px solid var(--border);border-radius:5px;padding:8px;text-align:center">
        <div class="text-xs text-t3">${k.toUpperCase()}</div>
        <div class="mono fw-700 mt-1" style="color:${ciaColor(a[k])}">${a[k]}/5</div>
      </div>`).join('')}
    </div>
    <div class="flex gap-2">
      <button class="btn btn-outline btn-sm flex-1" onclick="openEdit(${a.id})">Edit</button>
      <button class="btn btn-ghost btn-sm" style="color:var(--red)" onclick="del(${a.id})">Remove</button>
    </div>
  </div>`).join('');
        }

        function cs(c, i, a) { const avg = (c + i + a) / 3; return avg >= 4.5 ? 'Critical' : avg >= 3.5 ? 'High' : avg >= 2.5 ? 'Medium' : 'Low'; }
        const typeOpts = ['Web Application', 'Database', 'Server', 'Cloud Service', 'Network Device', 'Mobile App', 'API Service'];

        function openAdd() {
            openModal(`<h3>Add Asset</h3>
    <div class="form-group"><label class="form-label">Asset Name</label><input id="mN" class="form-control" placeholder="e.g. Payment Gateway API"/></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Type</label>
        <select id="mT" class="form-control">${typeOpts.map(t => `<option>${t}</option>`).join('')}</select></div>
      <div class="form-group"><label class="form-label">Owner</label><input id="mO" class="form-control" placeholder="Team or person"/></div>
    </div>
    <div class="form-group"><label class="form-label">Location</label><input id="mL" class="form-control" placeholder="e.g. AWS Cloud"/></div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
      <div class="form-group"><label class="form-label" title="Confidentiality">C (1–5)</label><input id="mC" type="number" min="1" max="5" value="3" class="form-control"/></div>
      <div class="form-group"><label class="form-label" title="Integrity">I (1–5)</label><input id="mI" type="number" min="1" max="5" value="3" class="form-control"/></div>
      <div class="form-group" style="margin-bottom:0"><label class="form-label" title="Availability">A (1–5)</label><input id="mA" type="number" min="1" max="5" value="3" class="form-control"/></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost btn-sm" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary btn-sm" onclick="addA()">Add Asset</button>
    </div>`);
        }

        function addA() {
            const name = document.getElementById('mN').value.trim();
            if (!name) { showToast('error', 'Validation', 'Asset name is required.'); return; }
            const c = +document.getElementById('mC').value || 3, i = +document.getElementById('mI').value || 3, a = +document.getElementById('mA').value || 3;
            const assets = S.assets;
            assets.push({ id: Date.now(), name, type: document.getElementById('mT').value, owner: document.getElementById('mO').value || 'Unknown', location: document.getElementById('mL').value || 'Unknown', c, i, a, criticality: cs(c, i, a) });
            S.setAssets(assets); closeModal(); render();
            showToast('success', 'Added', `"${name}" added to inventory.`);
        }

        function openEdit(id) {
            const a = S.assets.find(x => x.id === id); if (!a) return;
            openModal(`<h3>Edit Asset</h3>
    <div class="form-group"><label class="form-label">Asset Name</label><input id="eN" class="form-control" value="${a.name}"/></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Type</label>
        <select id="eT" class="form-control">${typeOpts.map(t => `<option${t === a.type ? ' selected' : ''}>${t}</option>`).join('')}</select></div>
      <div class="form-group"><label class="form-label">Owner</label><input id="eO" class="form-control" value="${a.owner}"/></div>
    </div>
    <div class="form-group"><label class="form-label">Location</label><input id="eL" class="form-control" value="${a.location}"/></div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
      <div class="form-group"><label class="form-label">C</label><input id="eC" type="number" min="1" max="5" value="${a.c}" class="form-control"/></div>
      <div class="form-group"><label class="form-label">I</label><input id="eI" type="number" min="1" max="5" value="${a.i}" class="form-control"/></div>
      <div class="form-group" style="margin-bottom:0"><label class="form-label">A</label><input id="eA" type="number" min="1" max="5" value="${a.a}" class="form-control"/></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost btn-sm" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary btn-sm" onclick="saveE(${id})">Save Changes</button>
    </div>`);
        }

        function saveE(id) {
            const assets = S.assets, a = assets.find(x => x.id === id); if (!a) return;
            const c = +document.getElementById('eC').value || a.c, i = +document.getElementById('eI').value || a.i, av = +document.getElementById('eA').value || a.a;
            a.name = document.getElementById('eN').value || a.name; a.type = document.getElementById('eT').value;
            a.owner = document.getElementById('eO').value || a.owner; a.location = document.getElementById('eL').value || a.location;
            a.c = c; a.i = i; a.a = av; a.criticality = cs(c, i, av);
            S.setAssets(assets); closeModal(); render();
            showToast('success', 'Updated', `"${a.name}" has been updated.`);
        }

        function del(id) {
            const a = S.assets.find(x => x.id === id);
            confirmAction(`Remove asset <strong>"${a?.name}"</strong>? This action cannot be undone.`, () => {
                S.setAssets(S.assets.filter(x => x.id !== id)); render();
                showToast('warning', 'Removed', `"${a?.name}" removed from inventory.`);
            });
        }
        render();
    </script>
</body>

</html>